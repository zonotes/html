<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œí—˜ë¬¸ì œ í’€ì´ TEST</title>
    <style>
        :root {
            --primary-color: #4a6eb5;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .question-container {
            margin-bottom: 30px;
        }
        
        .question-number {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .choices-container {
            margin-bottom: 20px;
        }
        
        .choice-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .choice-item:hover {
            background-color: #f8f8f8;
        }
        
        .choice-item.selected {
            background-color: #e3f2fd;
            border-color: var(--primary-color);
        }
        
        .choice-item.correct {
            background-color: rgba(40, 167, 69, 0.2);
            border-color: var(--success-color);
        }
        
        .choice-item.incorrect {
            background-color: rgba(220, 53, 69, 0.2);
            border-color: var(--danger-color);
        }
        
        .choice-label {
            font-weight: bold;
            margin-right: 10px;
            min-width: 30px;
        }
        
        .choice-text {
            flex-grow: 1;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .check-button {
            background-color: var(--primary-color);
            color: white;
        }
        
        .check-button:hover {
            background-color: #3a5ca0;
        }
        
        .next-button {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .next-button:hover {
            background-color: #5a6268;
        }
        
        .feedback {
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .feedback.correct {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success-color);
        }
        
        .feedback.incorrect {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger-color);
        }
        
        .progress-container {
            margin-bottom: 20px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: right;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .answer-display {
            font-weight: bold;
            margin-right: 15px;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #ddd;
            display: none;
        }
        
        .answer-display.correct {
            background-color: rgba(40, 167, 69, 0.2);
            border-color: var(--success-color);
            color: var(--success-color);
        }
        
        .answer-display.incorrect {
            background-color: rgba(220, 53, 69, 0.2);
            border-color: var(--danger-color);
            color: var(--danger-color);
        }
        
        .translation-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        
        .translation-title {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
        }
        
        .question-translation {
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .choice-translation {
            margin-bottom: 8px;
            display: flex;
        }
        
        .choice-translation-label {
            font-weight: bold;
            margin-right: 10px;
            min-width: 30px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
            }
            
            .question-text {
                font-size: 1rem;
            }
            
            .choice-item {
                padding: 8px;
            }
            
            .button-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .answer-display {
                margin-right: 0;
                margin-bottom: 10px;
                text-align: center;
            }
            
            button {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SFMC DC í€´ì¦ˆ</h1>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="progress-bar"></div>
            </div>
            <div class="progress-text" id="progress-text">0/0 ë¬¸ì œ ì™„ë£Œ</div>
        </div>
        
        <div class="question-container">
            <div class="question-number" id="question-number"></div>
            <div class="question-text" id="question-text"></div>
        </div>
        
        <div class="choices-container" id="choices-container"></div>
        
        <div class="feedback" id="feedback"></div>
        
        <div class="button-container">
            <div class="answer-display" id="answer-display"></div>
            <button class="check-button" id="check-button">ì •ë‹µ í™•ì¸</button>
            <button class="next-button" id="next-button">ë‹¤ìŒ ë¬¸ì œ</button>
        </div>
        
        <div class="translation-container" id="translation-container">
            <div class="translation-title">í•œê¸€ ë²ˆì—­</div>
            <div class="question-translation" id="question-kr"></div>
            <div id="choices-kr-container"></div>
        </div>
        
        <!-- ë””ë²„ê¹… ì •ë³´ ì„¹ì…˜ ì¶”ê°€ -->
        <div id="debug-section" style="margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 15px; font-size: 12px; display: none;">
            <h3>ë””ë²„ê¹… ì •ë³´</h3>
            <div id="debug-info"></div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let questionsEn = [];
        let questionsKr = [];
        let currentQuestion = null;
        let currentQuestionKr = null;
        let selectedChoices = new Set();
        let answeredQuestions = new Set();
        let isAnswered = false;
        let debugMode = false; // ë””ë²„ê¹… ëª¨ë“œ ë¹„í™œì„±í™”
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // JSON íŒŒì¼ ë¡œë“œ - ì„œë²„ í†µí•œ ì‹¤í–‰ í•„ìš”
                const [responseEn, responseKr] = await Promise.all([
                    fetch('qu_en.json').then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    }),
                    fetch('qu_kr.json').then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                ]);
                
                questionsEn = responseEn;
                questionsKr = responseKr;
                
                // í˜ì´ì§€ ì´ˆê¸°í™”
                initQuiz();
            } catch (error) {
                console.error('ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:', error);
                
                // ë¡œì»¬ ì‹¤í–‰ ì‹œ JSON ë¡œë“œ ì˜¤ë¥˜ ëŒ€ì‘
                alert('ë¬¸ì œ ë°ì´í„°ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì›¹ ì„œë²„ë¥¼ í†µí•´ í˜ì´ì§€ë¥¼ ì—´ì–´ì£¼ì„¸ìš”.\n(ì˜ˆ: VS Codeì˜ Live Server ë˜ëŠ” http-server ì´ìš©)');
                
                // í…ŒìŠ¤íŠ¸ìš© ë¡œì»¬ ë°ì´í„° (ì‹¤ì œ ë°°í¬ ì‹œ ì œê±°)
                console.log('í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                questionsEn = [
                    {
                        "question_no": 1,
                        "question": "ë‹¨ì¼ ì •ë‹µ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì…ë‹ˆë‹¤.",
                        "choices": {
                            "A.": "ì„ íƒì§€ A",
                            "B.": "ì„ íƒì§€ B",
                            "C.": "ì„ íƒì§€ C",
                            "D.": "ì„ íƒì§€ D"
                        },
                        "answer": "C"
                    },
                    {
                        "question_no": 2,
                        "question": "ë‹¤ì¤‘ ì •ë‹µ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì…ë‹ˆë‹¤.",
                        "choices": {
                            "A.": "ì„ íƒì§€ A",
                            "B.": "ì„ íƒì§€ B",
                            "C.": "ì„ íƒì§€ C",
                            "D.": "ì„ íƒì§€ D"
                        },
                        "answer": ["A", "C"]
                    }
                ];
                questionsKr = [
                    {
                        "question_no": 1,
                        "question": "ë‹¨ì¼ ì •ë‹µ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì…ë‹ˆë‹¤.",
                        "choices": {
                            "A.": "ì„ íƒì§€ A",
                            "B.": "ì„ íƒì§€ B",
                            "C.": "ì„ íƒì§€ C",
                            "D.": "ì„ íƒì§€ D"
                        }
                    },
                    {
                        "question_no": 2,
                        "question": "ë‹¤ì¤‘ ì •ë‹µ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ì…ë‹ˆë‹¤.",
                        "choices": {
                            "A.": "ì„ íƒì§€ A",
                            "B.": "ì„ íƒì§€ B",
                            "C.": "ì„ íƒì§€ C",
                            "D.": "ì„ íƒì§€ D"
                        }
                    }
                ];
                initQuiz();
            }
        });

        // ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥ í•¨ìˆ˜
        function logDebug(message, data) {
            if (debugMode) {
                console.log(message, data);
                
                const debugSection = document.getElementById('debug-section');
                const debugInfo = document.getElementById('debug-info');
                
                debugSection.style.display = 'block';
                
                const debugItem = document.createElement('div');
                debugItem.style.marginBottom = '10px';
                debugItem.innerHTML = `
                    <strong>${message}</strong>: 
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                debugInfo.appendChild(debugItem);
            }
        }

        // í€´ì¦ˆ ì´ˆê¸°í™”
        function initQuiz() {
            // ì²« ë¬¸ì œ í‘œì‹œ
            showNextQuestion();
            
            // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            document.getElementById('check-button').addEventListener('click', checkAnswer);
            document.getElementById('next-button').addEventListener('click', showNextQuestion);
            
            // ë””ë²„ê·¸ ëª¨ë“œ ì„¤ì •
            if (debugMode) {
                document.getElementById('debug-section').style.display = 'block';
            }
        }
        
        // ë‹¤ìŒ ë¬¸ì œ í‘œì‹œ
        function showNextQuestion() {
            // ë””ë²„ê·¸ ì •ë³´ ì´ˆê¸°í™”
            if (debugMode) {
                document.getElementById('debug-info').innerHTML = '';
            }
            
            // ì´ë¯¸ ë‹µë³€í•œ ëª¨ë“  ë¬¸ì œë¥¼ í’€ì—ˆë‹¤ë©´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘
            if (answeredQuestions.size === questionsEn.length) {
                alert('ëª¨ë“  ë¬¸ì œë¥¼ í’€ì—ˆìŠµë‹ˆë‹¤! ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.');
                answeredQuestions.clear();
            }
            
            // ì•„ì§ ë‹µë³€í•˜ì§€ ì•Šì€ ëœë¤ ë¬¸ì œ ì„ íƒ
            let availableQuestions = questionsEn.filter(q => !answeredQuestions.has(q.question_no));
            let randomIndex = Math.floor(Math.random() * availableQuestions.length);
            currentQuestion = availableQuestions[randomIndex];
            
            // í•´ë‹¹ í•œê¸€ ë¬¸ì œ ì°¾ê¸°
            currentQuestionKr = questionsKr.find(q => q.question_no === currentQuestion.question_no);
            
            if (!currentQuestionKr) {
                console.warn(`ë¬¸ì œ ${currentQuestion.question_no}ì— ëŒ€í•œ í•œê¸€ ë²ˆì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                currentQuestionKr = { question: "", choices: {} };
            }
            
            // ë¬¸ì œ ì •ë³´ í‘œì‹œ
            document.getElementById('question-number').textContent = `ë¬¸ì œ ${currentQuestion.question_no}`;
            document.getElementById('question-text').textContent = currentQuestion.question;
            
            // í•œê¸€ ì§ˆë¬¸ í‘œì‹œ (qu_kr íŒŒì¼ êµ¬ì¡°ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬)
            const questionKr = currentQuestionKr.question_kr || currentQuestionKr.question || "";
            document.getElementById('question-kr').textContent = questionKr || currentQuestion.question;
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ì •ë³´ ì¶œë ¥
            logDebug('í˜„ì¬ ë¬¸ì œ', currentQuestion);
            logDebug('ì •ë‹µ í˜•ì‹', {
                type: typeof currentQuestion.answer, 
                value: currentQuestion.answer,
                isArray: Array.isArray(currentQuestion.answer)
            });
            
            // ë‹¤ì¤‘ ì •ë‹µì¸ ê²½ìš° UIì— ì•ˆë‚´ í‘œì‹œ
            const isMultiAnswer = Array.isArray(currentQuestion.answer) && currentQuestion.answer.length > 1;
            let multiAnswerHint = '';
            if (isMultiAnswer) {
                multiAnswerHint = '<div style="color: #e74c3c; font-weight: bold; margin-top: 10px;">* ì´ ë¬¸ì œëŠ” ì •ë‹µì´ ì—¬ëŸ¬ ê°œì…ë‹ˆë‹¤. í•´ë‹¹ë˜ëŠ” ëª¨ë“  í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”.</div>';
                document.querySelector('.question-container').insertAdjacentHTML('beforeend', multiAnswerHint);
            }
            
            // ì„ íƒì§€ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            const choicesContainer = document.getElementById('choices-container');
            choicesContainer.innerHTML = '';
            
            // í•œê¸€ ì„ íƒì§€ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            const choicesKrContainer = document.getElementById('choices-kr-container');
            choicesKrContainer.innerHTML = '';
            
            // ì„ íƒì§€ ìˆœì„œ ì„ê¸°
            const choiceKeys = Object.keys(currentQuestion.choices);
            const shuffledChoiceKeys = [...choiceKeys].sort(() => Math.random() - 0.5);
            
            // ì„ íƒì§€ ì¶”ê°€
            shuffledChoiceKeys.forEach(key => {
                const choiceItem = document.createElement('div');
                choiceItem.className = 'choice-item';
                choiceItem.dataset.choice = key;
                
                // ì˜ë¬¸ ì„ íƒì§€ í‘œì‹œ
                choiceItem.innerHTML = `
                    <div class="choice-label">${key}</div>
                    <div class="choice-content">
                        <div class="choice-text">${currentQuestion.choices[key]}</div>
                    </div>
                `;
                
                choiceItem.addEventListener('click', function() {
                    if (!isAnswered) {
                        // ë‹¤ì¤‘ ì„ íƒì„ ìœ„í•œ ì²˜ë¦¬
                        if (selectedChoices.has(key)) {
                            selectedChoices.delete(key);
                            this.classList.remove('selected');
                        } else {
                            selectedChoices.add(key);
                            this.classList.add('selected');
                        }
                        
                        // ë””ë²„ê¹…ì„ ìœ„í•œ ì •ë³´ ì¶œë ¥
                        logDebug('í˜„ì¬ ì„ íƒëœ í•­ëª©', Array.from(selectedChoices));
                    }
                });
                
                choicesContainer.appendChild(choiceItem);
                
                // í•œê¸€ ì„ íƒì§€ ê°€ì ¸ì˜¤ê¸° (qu_kr íŒŒì¼ êµ¬ì¡°ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬)
                let choiceKr = "";
                if (currentQuestionKr.choices_kr && currentQuestionKr.choices_kr[key]) {
                    choiceKr = currentQuestionKr.choices_kr[key];
                } else if (currentQuestionKr.choices && currentQuestionKr.choices[key]) {
                    choiceKr = currentQuestionKr.choices[key];
                } else {
                    choiceKr = currentQuestion.choices[key]; // í•œê¸€ ë²ˆì—­ì´ ì—†ìœ¼ë©´ ì˜ë¬¸ ì‚¬ìš©
                }
                
                // í•œê¸€ ì„ íƒì§€ í‘œì‹œ (ë³„ë„ ì„¹ì…˜ì—)
                const choiceKrItem = document.createElement('div');
                choiceKrItem.className = 'choice-translation';
                choiceKrItem.innerHTML = `
                    <div class="choice-translation-label">${key}</div>
                    <div>${choiceKr}</div>
                `;
                
                choicesKrContainer.appendChild(choiceKrItem);
            });
            
            // í”¼ë“œë°± ì´ˆê¸°í™”
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'none';
            feedback.classList.remove('correct', 'incorrect');
            
            // ì •ë‹µ í‘œì‹œ ì´ˆê¸°í™”
            const answerDisplay = document.getElementById('answer-display');
            answerDisplay.style.display = 'none';
            answerDisplay.classList.remove('correct', 'incorrect');
            
            // ìƒíƒœ ì´ˆê¸°í™”
            isAnswered = false;
            selectedChoices.clear();
            
            // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateProgress();
        }
        
        // ì •ë‹µ í™•ì¸
        function checkAnswer() {
            if (selectedChoices.size === 0) {
                alert('ë‹µë³€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (isAnswered) {
                return;
            }
            
            isAnswered = true;
            answeredQuestions.add(currentQuestion.question_no);
            
            const feedback = document.getElementById('feedback');
            const answerDisplay = document.getElementById('answer-display');
            
            // ì •ë‹µ ì¶”ì¶œ ë° ì •ê·œí™”
            let originalAnswers = [];
            
            // ì •ë‹µ í˜•ì‹ì— ë”°ë¥¸ ì²˜ë¦¬
            if (typeof currentQuestion.answer === 'string') {
                // ë¬¸ìì—´ í˜•ì‹ ì²˜ë¦¬
                if (currentQuestion.answer.includes(',')) {
                    // ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ë‹¤ì¤‘ ì •ë‹µ (ì˜ˆ: "A,B" ë˜ëŠ” "A,B,C")
                    originalAnswers = currentQuestion.answer.split(',').map(a => a.trim());
                    logDebug('ì½¤ë§ˆë¡œ êµ¬ë¶„ëœ ë‹¤ì¤‘ ì •ë‹µ ê°ì§€', originalAnswers);
                } else {
                    // ë‹¨ì¼ ì •ë‹µ (ë¬¸ìì—´)
                    originalAnswers = [currentQuestion.answer];
                }
            } else if (Array.isArray(currentQuestion.answer)) {
                // ë‹¤ì¤‘ ì •ë‹µ (ë°°ì—´)
                originalAnswers = currentQuestion.answer;
            } else if (typeof currentQuestion.answer === 'object' && currentQuestion.answer !== null) {
                // ê°ì²´ í˜•íƒœì˜ ì •ë‹µ (ì¼ë¶€ JSON í˜•ì‹ì—ì„œ ê°€ëŠ¥)
                originalAnswers = Object.values(currentQuestion.answer);
            } else {
                console.error('ì•Œ ìˆ˜ ì—†ëŠ” ì •ë‹µ í˜•ì‹:', currentQuestion.answer);
                originalAnswers = [];
            }
            
            // ì›ë³¸ ì •ë‹µ ë°ì´í„° ë³´ì¡´ (í‘œì‹œìš©)
            const displayAnswers = [...originalAnswers];
            
            // ì •ë‹µ ì •ê·œí™” (ë¹„êµìš©)
            const normalizedAnswers = originalAnswers.map(answer => {
                // ë¬¸ìì—´ë¡œ ë³€í™˜ í›„ ì (.)ì„ ì œê±°í•˜ê³  ì†Œë¬¸ìë¡œ ë³€í™˜
                return String(answer).trim().replace(/\.$/g, '').toLowerCase();
            });
            
            // ì‚¬ìš©ì ì„ íƒ ì •ê·œí™”
            const normalizedSelectedChoices = Array.from(selectedChoices).map(choice => {
                // ì (.)ì„ ì œê±°í•˜ê³  ì†Œë¬¸ìë¡œ ë³€í™˜
                return choice.trim().replace(/\.$/g, '').toLowerCase();
            });
            
            // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
            logDebug('ë¬¸ì œ ë²ˆí˜¸', currentQuestion.question_no);
            logDebug('ì›ë³¸ ì •ë‹µ', currentQuestion.answer);
            logDebug('ë³€í™˜ëœ ì›ë³¸ ì •ë‹µ', originalAnswers);
            logDebug('ì •ê·œí™”ëœ ì •ë‹µ', normalizedAnswers);
            logDebug('ì‚¬ìš©ì ì„ íƒ', Array.from(selectedChoices));
            logDebug('ì •ê·œí™”ëœ ì‚¬ìš©ì ì„ íƒ', normalizedSelectedChoices);
            
            // ì •ë‹µ ë¹„êµ (ì •ê·œí™”ëœ í˜•íƒœë¡œ ë¹„êµ)
            let isCorrect = false;
            
            // ì •ë‹µê³¼ ì„ íƒì§€ì˜ ê°œìˆ˜ê°€ ê°™ê³  ë‚´ìš©ì´ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
            if (normalizedAnswers.length === normalizedSelectedChoices.length) {
                // ëª¨ë“  ì •ë‹µì´ ì„ íƒë˜ì—ˆëŠ”ì§€ í™•ì¸
                const allAnswersSelected = normalizedAnswers.every(answer => {
                    return normalizedSelectedChoices.includes(answer);
                });
                
                // ëª¨ë“  ì„ íƒì´ ì •ë‹µì¸ì§€ í™•ì¸
                const allSelectionsCorrect = normalizedSelectedChoices.every(choice => {
                    return normalizedAnswers.includes(choice);
                });
                
                // ì–‘ë°©í–¥ ëª¨ë‘ ì¼ì¹˜í•´ì•¼ ì •ë‹µìœ¼ë¡œ ì¸ì •
                isCorrect = allAnswersSelected && allSelectionsCorrect;
                
                logDebug('ëª¨ë“  ì •ë‹µì´ ì„ íƒë¨', allAnswersSelected);
                logDebug('ëª¨ë“  ì„ íƒì´ ì •ë‹µì„', allSelectionsCorrect);
            }
            
            logDebug('ìµœì¢… ì •ë‹µ ì—¬ë¶€', isCorrect);
            
            // ì„ íƒí•œ í•­ëª©ë“¤ì— ì •ë‹µ ì—¬ë¶€ í‘œì‹œ
            selectedChoices.forEach(choice => {
                const item = document.querySelector(`.choice-item[data-choice="${choice}"]`);
                if (!item) {
                    console.warn(`ì„ íƒí•œ í•­ëª© ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${choice}`);
                    return;
                }
                
                // ì •ê·œí™”í•˜ì—¬ ë¹„êµ
                const normalizedChoice = choice.replace(/\.$/g, '').toLowerCase();
                const isChoiceCorrect = normalizedAnswers.includes(normalizedChoice);
                
                if (isChoiceCorrect) {
                    item.classList.add('correct');
                } else {
                    item.classList.add('incorrect');
                }
            });
            
            // ì„ íƒí•˜ì§€ ì•Šì€ ì •ë‹µ í‘œì‹œ
            document.querySelectorAll('.choice-item').forEach(item => {
                const choice = item.dataset.choice;
                if (!selectedChoices.has(choice)) {
                    // ì •ê·œí™”í•˜ì—¬ ë¹„êµ
                    const normalizedChoice = choice.replace(/\.$/g, '').toLowerCase();
                    const isCorrectAnswer = normalizedAnswers.includes(normalizedChoice);
                    
                    if (isCorrectAnswer) {
                        item.classList.add('correct');
                    }
                }
            });
            
            // ì •ë‹µ ì •ë³´ í‘œì‹œ
            if (isCorrect) {
                feedback.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘';
                feedback.classList.add('correct');
            } else {
                feedback.textContent = 'ì˜¤ë‹µì…ë‹ˆë‹¤.';
                feedback.classList.add('incorrect');
            }
            
            // í‘œì‹œí•  ì •ë‹µ í˜•ì‹ ì§€ì •
            let answerText = '';
            if (displayAnswers.length === 1) {
                answerText = `ì •ë‹µ: ${displayAnswers[0]}`;
            } else {
                answerText = `ì •ë‹µ: ${displayAnswers.join(', ')}`;
            }
            
            answerDisplay.textContent = answerText;
            answerDisplay.classList.add(isCorrect ? 'correct' : 'incorrect');
            
            feedback.style.display = 'block';
            answerDisplay.style.display = 'block';
            
            // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateProgress();
        }
        
        // ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateProgress() {
            const progressText = document.getElementById('progress-text');
            const progressBar = document.getElementById('progress-bar');
            
            const completed = answeredQuestions.size;
            const total = questionsEn.length;
            const percentage = (completed / total) * 100;
            
            progressText.textContent = `${completed}/${total} ë¬¸ì œ ì™„ë£Œ`;
            progressBar.style.width = `${percentage}%`;
        }
    </script>
</body>
</html>
